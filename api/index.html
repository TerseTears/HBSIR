
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../calculator/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.10">
    
    
      
        <title>API - Household Budget Survey</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Household Budget Survey" class="md-header__button md-logo" aria-label="Household Budget Survey" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Household Budget Survey
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  API

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../calculator/" class="md-tabs__link">
        
  
    
  
  Calclulator

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../tables/" class="md-tabs__link">
          
  
  Tables

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Household Budget Survey" class="md-nav__button md-logo" aria-label="Household Budget Survey" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Household Budget Survey
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hbsir.api" class="md-nav__link">
    <span class="md-ellipsis">
      api
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      add_attribute()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_attribute()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_classification" class="md-nav__link">
    <span class="md-ellipsis">
      add_classification()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_classification()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_classification--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_classification--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_cpi" class="md-nav__link">
    <span class="md-ellipsis">
      add_cpi()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_cpi()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_cpi--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_cpi--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_weight" class="md-nav__link">
    <span class="md-ellipsis">
      add_weight()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_weight()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_weight--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_weight--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_cpi" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_by_cpi()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="adjust_by_cpi()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_cpi--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_cpi--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_equivalence_scale" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_by_equivalence_scale()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="adjust_by_equivalence_scale()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_equivalence_scale--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_equivalence_scale--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema" class="md-nav__link">
    <span class="md-ellipsis">
      create_table_with_schema()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_table_with_schema()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.load_table" class="md-nav__link">
    <span class="md-ellipsis">
      load_table()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_table()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--loads-processed-food-table-from-original-survey-tables-for" class="md-nav__link">
    <span class="md-ellipsis">
      Loads processed 'food' table from original survey tables for
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--loads-standard-expenditures-table-for-years-1399-1401" class="md-nav__link">
    <span class="md-ellipsis">
      Loads standard 'Expenditures' table for years 1399 - 1401
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loads standard 'Expenditures' table for years 1399 - 1401">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.select" class="md-nav__link">
    <span class="md-ellipsis">
      select()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="select()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.select--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.select--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.setup_config" class="md-nav__link">
    <span class="md-ellipsis">
      setup_config()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup_config()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.setup_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      setup_metadata()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup_metadata()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup_metadata--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../calculator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calclulator
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tables
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tables
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/agricultural_self_employed_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    agricultural_self_employed_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/census_month/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    census_month
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/cloth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cloth
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/communication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    communication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/durable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    durable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/education/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    education
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/employment_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    employment_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/entertainment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    entertainment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/food/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    food
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/furniture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    furniture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/hotel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hotel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/household_information/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    household_information
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/house_specifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    house_specifications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/investment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    investment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/medical/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medical
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/members_properties/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    members_properties
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/miscellaneous/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    miscellaneous
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/non_agricultural_self_employed_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    non_agricultural_self_employed_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/old_other_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    old_other_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/other_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    other_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/private_employment_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    private_employment_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/public_employment_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    public_employment_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/self_employed_income/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    self_employed_income
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/subsidy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    subsidy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/tobacco/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tobacco
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tables/transportation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    transportation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hbsir.api" class="md-nav__link">
    <span class="md-ellipsis">
      api
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_attribute" class="md-nav__link">
    <span class="md-ellipsis">
      add_attribute()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_attribute()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_attribute--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_attribute--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_classification" class="md-nav__link">
    <span class="md-ellipsis">
      add_classification()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_classification()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_classification--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_classification--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_cpi" class="md-nav__link">
    <span class="md-ellipsis">
      add_cpi()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_cpi()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_cpi--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_cpi--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.add_weight" class="md-nav__link">
    <span class="md-ellipsis">
      add_weight()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_weight()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_weight--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.add_weight--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_cpi" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_by_cpi()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="adjust_by_cpi()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_cpi--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_cpi--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_equivalence_scale" class="md-nav__link">
    <span class="md-ellipsis">
      adjust_by_equivalence_scale()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="adjust_by_equivalence_scale()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_equivalence_scale--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.adjust_by_equivalence_scale--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema" class="md-nav__link">
    <span class="md-ellipsis">
      create_table_with_schema()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_table_with_schema()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.create_table_with_schema--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.load_table" class="md-nav__link">
    <span class="md-ellipsis">
      load_table()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_table()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--loads-processed-food-table-from-original-survey-tables-for" class="md-nav__link">
    <span class="md-ellipsis">
      Loads processed 'food' table from original survey tables for
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--loads-standard-expenditures-table-for-years-1399-1401" class="md-nav__link">
    <span class="md-ellipsis">
      Loads standard 'Expenditures' table for years 1399 - 1401
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loads standard 'Expenditures' table for years 1399 - 1401">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.load_table--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.select" class="md-nav__link">
    <span class="md-ellipsis">
      select()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="select()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.select--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.select--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.setup_config" class="md-nav__link">
    <span class="md-ellipsis">
      setup_config()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup_config()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hbsir.api.setup_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      setup_metadata()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="setup_metadata()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hbsir.api.setup_metadata--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="api">API</h1>


<div class="doc doc-object doc-module">



<a id="hbsir.api"></a>
  <div class="doc doc-contents first">
  
      <p>HBSIR - Iran Household Budget Survey Data API.</p>
<p>This module provides an API for loading, processing, and analyzing
Iran's Household Budget Survey (HBSIR) data.</p>
<p>The key functions provided are:</p>
<ul>
<li>
<p>load_table: Load HBSIR data for a given table name and year range.</p>
</li>
<li>
<p>add_classification: Add commodity/occupation classification codes.</p>
</li>
<li>
<p>add_attribute: Add household attributes like urban/rural status. </p>
</li>
<li>
<p>add_weight: Add sampling weights.</p>
</li>
<li>
<p>add_cpi: Join CPI index data.</p>
</li>
<li>
<p>select: Filter table by urban/rural, province etc. </p>
</li>
<li>
<p>adjust_by_cpi: Adjust monetary values for inflation using CPI.</p>
</li>
<li>
<p>adjust_by_equivalence_scale: Adjust by household composition.</p>
</li>
<li>
<p>create_table_with_schema: Create table from schema.</p>
</li>
<li>
<p>setup: Download, extract and process survey data.</p>
</li>
<li>
<p>setup_config: Copy default config files.</p>
</li>
<li>
<p>setup_metadata: Copy default metadata.</p>
</li>
</ul>
<p>See the API docstrings for more details.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="hbsir.api.add_attribute" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_attribute</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">aspects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">id_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">year_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add household attributes to table based on ID.</p>
<p>Takes a DataFrame with a household ID column and adds columns
for the specified attribute such as urban/rural status or province.</p>
<p>Supported attributes:</p>
<ul>
<li>'Urban_Rural': Urban or rural classification</li>
<li>'Province': Province name</li>
<li>'County': County name</li>
</ul>
<h4 id="hbsir.api.add_attribute--parameters">Parameters</h4>
<p>table : DataFrame
    DataFrame containing ID column.
name : str
    Name of attribute to add.
aspects: list of str, optional
    Aspects of attribute to add as columns.
column_names: list of str, optional
    Output column names.
id_col: str, optional
    Name of ID column.
year_col: str, optional
    Name of year column.</p>
<h4 id="hbsir.api.add_attribute--returns">Returns</h4>
<p>DataFrame
    Input DataFrame with added attribute columns.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_attribute</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">_Attribute</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">aspects</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">column_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">id_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">year_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add household attributes to table based on ID.</span>

<span class="sd">    Takes a DataFrame with a household ID column and adds columns</span>
<span class="sd">    for the specified attribute such as urban/rural status or province.</span>

<span class="sd">    Supported attributes:</span>

<span class="sd">    - &#39;Urban_Rural&#39;: Urban or rural classification</span>
<span class="sd">    - &#39;Province&#39;: Province name</span>
<span class="sd">    - &#39;County&#39;: County name</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : DataFrame</span>
<span class="sd">        DataFrame containing ID column.</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of attribute to add.</span>
<span class="sd">    aspects: list of str, optional</span>
<span class="sd">        Aspects of attribute to add as columns.</span>
<span class="sd">    column_names: list of str, optional</span>
<span class="sd">        Output column names.</span>
<span class="sd">    id_col: str, optional</span>
<span class="sd">        Name of ID column.</span>
<span class="sd">    year_col: str, optional</span>
<span class="sd">        Name of year column.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Input DataFrame with added attribute columns.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">_extract_parameters</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">IDDecoderSettings</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">IDDecoder</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span><span class="o">.</span><span class="n">add_attribute</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.add_classification" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_classification</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">classification_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">aspects</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">missing_value_replacements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">code_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">year_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add classification columns to table.</p>
<p>Classifies codes in the table using specified classification system.</p>
<p>Supported systems:</p>
<ul>
<li>'commodity': Classifies commodity codes</li>
<li>'industry': Classifies industry codes</li>
<li>'occupation': Classifies occupation codes</li>
</ul>
<h4 id="hbsir.api.add_classification--parameters">Parameters</h4>
<p>table : DataFrame
    Table containing code column to classify.
name : str, default 'original'
    Name of classification to apply.
classification_type : str, optional
    Type of classification system.
aspects : list, optional
    Aspects of classification to add as columns.
levels : list of int, optional
    Number of digits for each classification level.
column_names: list of str, optional
    Names of output columns.
drop_value : bool, optional
    Whether to drop unclassified values.
missing_value_replacements : dict, optional
    Replacements for missing values in columns.
code_col: str, optional
    Name of the code column.
year_col: str, optional
    Name of the year column.</p>
<h4 id="hbsir.api.add_classification--returns">Returns</h4>
<p>DataFrame
    Table with added classification columns.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_classification</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;original&quot;</span><span class="p">,</span>
    <span class="n">classification_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;commodity&quot;</span><span class="p">,</span> <span class="s2">&quot;industry&quot;</span><span class="p">,</span> <span class="s2">&quot;occupation&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">aspects</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">levels</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">column_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">drop_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">missing_value_replacements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">code_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">year_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add classification columns to table.</span>

<span class="sd">    Classifies codes in the table using specified classification system.</span>

<span class="sd">    Supported systems:</span>

<span class="sd">    - &#39;commodity&#39;: Classifies commodity codes</span>
<span class="sd">    - &#39;industry&#39;: Classifies industry codes</span>
<span class="sd">    - &#39;occupation&#39;: Classifies occupation codes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : DataFrame</span>
<span class="sd">        Table containing code column to classify.</span>
<span class="sd">    name : str, default &#39;original&#39;</span>
<span class="sd">        Name of classification to apply.</span>
<span class="sd">    classification_type : str, optional</span>
<span class="sd">        Type of classification system.</span>
<span class="sd">    aspects : list, optional</span>
<span class="sd">        Aspects of classification to add as columns.</span>
<span class="sd">    levels : list of int, optional</span>
<span class="sd">        Number of digits for each classification level.</span>
<span class="sd">    column_names: list of str, optional</span>
<span class="sd">        Names of output columns.</span>
<span class="sd">    drop_value : bool, optional</span>
<span class="sd">        Whether to drop unclassified values.</span>
<span class="sd">    missing_value_replacements : dict, optional</span>
<span class="sd">        Replacements for missing values in columns.</span>
<span class="sd">    code_col: str, optional</span>
<span class="sd">        Name of the code column.</span>
<span class="sd">    year_col: str, optional</span>
<span class="sd">        Name of the year column.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Table with added classification columns.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">_extract_parameters</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="k">if</span> <span class="s2">&quot;classification_type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;code_column_name&quot;</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table</span><span class="p">[</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;code_column_name&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.9</span><span class="p">:</span>
                <span class="n">class_type</span> <span class="o">=</span> <span class="s2">&quot;occupation&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">class_type</span> <span class="o">=</span> <span class="s2">&quot;commodity&quot;</span>
        <span class="k">elif</span> <span class="n">metadata_reader</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">commodity_code</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">class_type</span> <span class="o">=</span> <span class="s2">&quot;commodity&quot;</span>
        <span class="k">elif</span> <span class="n">metadata_reader</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">job_code</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">class_type</span> <span class="o">=</span> <span class="s2">&quot;occupation&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing Code Column&quot;</span><span class="p">)</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;classification_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_type</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">DecoderSettings</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span><span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">)</span><span class="o">.</span><span class="n">add_classification</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.add_cpi" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_cpi</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">data_source</span><span class="o">=</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="n">base_year</span><span class="o">=</span><span class="mi">1400</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="s1">&#39;Annual&#39;</span><span class="p">,</span> <span class="n">separate_by</span><span class="o">=</span><span class="s1">&#39;Urban_Rural&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add CPI values to the table</p>
<h4 id="hbsir.api.add_cpi--parameters">Parameters</h4>
<p>table : pd.DataFrame
    Input DataFrame to add CPI values to.
data_source : str, default "SCI"
    Source of CPI data, either "SCI" or "CBS".
base_year : int, default 1400
    Base year for CPI.
frequency : str, default "Annual"
    Frequency of CPI data, either "Annual" or "Monthly".
separate_by : str, default "Urban_Rural"
    Column to separate CPI by, either "Urban_Rural" or None.</p>
<h4 id="hbsir.api.add_cpi--returns">Returns</h4>
<p>DataFrame
    Input <code>table</code> with 'CPI' column added.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_cpi</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;SCI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SCI&quot;</span><span class="p">,</span>
    <span class="n">base_year</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1400</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Annual&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Annual&quot;</span><span class="p">,</span>
    <span class="n">separate_by</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Urban_Rural&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Urban_Rural&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add CPI values to the table</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : pd.DataFrame</span>
<span class="sd">        Input DataFrame to add CPI values to.</span>
<span class="sd">    data_source : str, default &quot;SCI&quot;</span>
<span class="sd">        Source of CPI data, either &quot;SCI&quot; or &quot;CBS&quot;.</span>
<span class="sd">    base_year : int, default 1400</span>
<span class="sd">        Base year for CPI.</span>
<span class="sd">    frequency : str, default &quot;Annual&quot;</span>
<span class="sd">        Frequency of CPI data, either &quot;Annual&quot; or &quot;Monthly&quot;.</span>
<span class="sd">    separate_by : str, default &quot;Urban_Rural&quot;</span>
<span class="sd">        Column to separate CPI by, either &quot;Urban_Rural&quot; or None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Input `table` with &#39;CPI&#39; column added.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cpi</span> <span class="o">=</span> <span class="n">external_data</span><span class="o">.</span><span class="n">load_table</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;CPI_</span><span class="si">{</span><span class="n">base_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">data_source</span><span class="o">=</span><span class="n">data_source</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span>
        <span class="n">separate_by</span><span class="o">=</span><span class="n">separate_by</span><span class="p">,</span>
        <span class="n">reset_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">separate_by</span> <span class="o">==</span> <span class="s2">&quot;Urban_Rural&quot;</span><span class="p">:</span>
        <span class="n">urban_rural_available</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;Urban_Rural&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">add_attribute</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s2">&quot;Urban_Rural&quot;</span><span class="p">)</span>
            <span class="n">urban_rural_available</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Urban_Rural&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">urban_rural_available</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Urban_Rural&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpi</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.add_weight" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">add_weight</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">adjust_for_household_size</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add sampling weights to the table.</p>
<p>Loads appropriate sample weights for each year in the table and merges
them onto the table. Sample weights can optionally be adjusted
for household size.</p>
<p>Weights for years prior to 1395 are loaded from external parquet data,
while weights for 1395 onward come from the household_information table.</p>
<h4 id="hbsir.api.add_weight--parameters">Parameters</h4>
<p>table : pd.DataFrame
    Input data table, containing a column of year values
adjust_for_household_size : bool, default False
    Whether to adjust weights by household size
year_column_name : str, default "Year"
    Name of column in <code>table</code> that contains the year</p>
<h4 id="hbsir.api.add_weight--returns">Returns</h4>
<p>table : pd.DataFrame
    Input <code>table</code> with 'Weight' column added</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_weight</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">adjust_for_household_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add sampling weights to the table.</span>

<span class="sd">    Loads appropriate sample weights for each year in the table and merges</span>
<span class="sd">    them onto the table. Sample weights can optionally be adjusted</span>
<span class="sd">    for household size.</span>

<span class="sd">    Weights for years prior to 1395 are loaded from external parquet data,</span>
<span class="sd">    while weights for 1395 onward come from the household_information table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : pd.DataFrame</span>
<span class="sd">        Input data table, containing a column of year values</span>
<span class="sd">    adjust_for_household_size : bool, default False</span>
<span class="sd">        Whether to adjust weights by household size</span>
<span class="sd">    year_column_name : str, default &quot;Year&quot;</span>
<span class="sd">        Name of column in `table` that contains the year</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    table : pd.DataFrame</span>
<span class="sd">        Input `table` with &#39;Weight&#39; column added</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">data_engine</span><span class="o">.</span><span class="n">add_weights</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">adjust_for_household_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.adjust_by_cpi" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">adjust_by_cpi</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Adjust columns in the table by the CPI</p>
<p>Divides the specified columns of the DataFrame by the CPI column.
If no columns specified, divides common monetary value columns
like 'Expenditure', 'Income' etc.</p>
<h4 id="hbsir.api.adjust_by_cpi--parameters">Parameters</h4>
<p>table : DataFrame
    DataFrame containing a "CPI" column.
columns : List[str], optional
    List of columns names to divide by CPI.
**kwargs
    Additional keyword arguments passed to add_cpi.</p>
<h4 id="hbsir.api.adjust_by_cpi--returns">Returns</h4>
<p>DataFrame
    Input <code>table</code> with <code>columns</code> divided by 'CPI'.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adjust_by_cpi</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust columns in the table by the CPI</span>

<span class="sd">    Divides the specified columns of the DataFrame by the CPI column.</span>
<span class="sd">    If no columns specified, divides common monetary value columns</span>
<span class="sd">    like &#39;Expenditure&#39;, &#39;Income&#39; etc.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : DataFrame</span>
<span class="sd">        DataFrame containing a &quot;CPI&quot; column.</span>
<span class="sd">    columns : List[str], optional</span>
<span class="sd">        List of columns names to divide by CPI.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Additional keyword arguments passed to add_cpi.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Input `table` with `columns` divided by &#39;CPI&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_columns</span> <span class="o">=</span> <span class="n">metadata_reader</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">nominals</span>
    <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">default_columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="n">cpi_available</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">&quot;CPI&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">add_cpi</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cpi_available</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">table</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">columns</span><span class="p">]</span>
        <span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CPI&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cpi_available</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;CPI&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.adjust_by_equivalence_scale" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">adjust_by_equivalence_scale</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">equivalence_scale</span><span class="o">=</span><span class="s1">&#39;Per_Capita&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Adjust columns by household equivalence scale.</p>
<p>Divides specified columns by household equivalence scale
to account for household size and composition.</p>

<details class="supported-scales-are" open>
  <summary>Supported scales are</summary>
  <ul>
<li>Household: No adjustment (household total)</li>
<li>Per_Capita: Divide by household size</li>
<li>OECD: OECD equivalence scale</li>
<li>OECD_Modified: Modified OECD scale</li>
<li>Square_Root: Square root of household size</li>
</ul>
</details>      <p>Loads equivalence scales from Equivalence_Scale table.</p>
<h4 id="hbsir.api.adjust_by_equivalence_scale--parameters">Parameters</h4>
<p>table : DataFrame
    Input DataFrame with household ID.
columns : List[str]
    Columns to adjust.
equivalence_scale : _EquivalenceScale, default "Per_Capita"
    Equivalence scale to use.</p>
<h4 id="hbsir.api.adjust_by_equivalence_scale--returns">Returns</h4>
<p>DataFrame
    Table with adjusted columns.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">adjust_by_equivalence_scale</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">equivalence_scale</span><span class="p">:</span> <span class="n">_EquivalenceScale</span> <span class="o">=</span> <span class="s2">&quot;Per_Capita&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust columns by household equivalence scale.</span>

<span class="sd">    Divides specified columns by household equivalence scale</span>
<span class="sd">    to account for household size and composition.</span>

<span class="sd">    Supported scales are:</span>
<span class="sd">        - Household: No adjustment (household total)</span>
<span class="sd">        - Per_Capita: Divide by household size</span>
<span class="sd">        - OECD: OECD equivalence scale</span>
<span class="sd">        - OECD_Modified: Modified OECD scale</span>
<span class="sd">        - Square_Root: Square root of household size</span>

<span class="sd">    Loads equivalence scales from Equivalence_Scale table.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : DataFrame</span>
<span class="sd">        Input DataFrame with household ID.</span>
<span class="sd">    columns : List[str]</span>
<span class="sd">        Columns to adjust.</span>
<span class="sd">    equivalence_scale : _EquivalenceScale, default &quot;Per_Capita&quot;</span>
<span class="sd">        Equivalence scale to use.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Table with adjusted columns.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">defaults</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">equivalence_table</span> <span class="o">=</span> <span class="n">load_table</span><span class="p">(</span><span class="s2">&quot;Equivalence_Scale&quot;</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
        <span class="p">[</span><span class="n">defaults</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">defaults</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">household_id</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">equivalence_table</span><span class="p">[</span><span class="n">equivalence_scale</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
    <span class="p">)</span>
    <span class="n">table</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">equivalence_scale</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">equivalence_scale</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.create_table_with_schema" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_table_with_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">redownload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_downloaded</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_created</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create and load table based on input schema.</p>
<p>This function can be used in two ways:</p>
<p>1) If a schema dictionary is passed, it will generate a DataFrame
by loading or creating data that matches the schema.</p>
<p>2) If a string table name is passed, it will load the table with
that name from the external schema.</p>
<h4 id="hbsir.api.create_table_with_schema--parameters">Parameters</h4>
<p>schema : dict or str
    Dictionary defining schema or string table name.
years : str, optional
    Year(s) to load.
on_missing : {'error', 'download', 'create'}, optional
    Action if data is missing.
save_downloaded : bool, optional
    Whether to save downloaded data.
save_created : bool, optional
   Whether to save newly created data.</p>
<h4 id="hbsir.api.create_table_with_schema--returns">Returns</h4>
<p>DataFrame
    Loaded or created DataFrame.</p>
<h4 id="hbsir.api.create_table_with_schema--examples">Examples</h4>
<blockquote>
<blockquote>
<blockquote>
<p>schema = {'table_list': ['food', 'tobacco'], 'years':'1398-1400'}
df = create_table_with_schema(schema)</p>
<p>table_name = 'User_Defined_Table'
df = create_table_with_schema(table_name)</p>
</blockquote>
</blockquote>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_table_with_schema</span><span class="p">(</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">years</span><span class="p">:</span> <span class="n">_Years</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_missing</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">redownload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_downloaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_created</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and load table based on input schema.</span>

<span class="sd">    This function can be used in two ways:</span>

<span class="sd">    1) If a schema dictionary is passed, it will generate a DataFrame</span>
<span class="sd">    by loading or creating data that matches the schema.</span>

<span class="sd">    2) If a string table name is passed, it will load the table with</span>
<span class="sd">    that name from the external schema.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    schema : dict or str</span>
<span class="sd">        Dictionary defining schema or string table name.</span>
<span class="sd">    years : str, optional</span>
<span class="sd">        Year(s) to load.</span>
<span class="sd">    on_missing : {&#39;error&#39;, &#39;download&#39;, &#39;create&#39;}, optional</span>
<span class="sd">        Action if data is missing.</span>
<span class="sd">    save_downloaded : bool, optional</span>
<span class="sd">        Whether to save downloaded data.</span>
<span class="sd">    save_created : bool, optional</span>
<span class="sd">       Whether to save newly created data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Loaded or created DataFrame.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; schema = {&#39;table_list&#39;: [&#39;food&#39;, &#39;tobacco&#39;], &#39;years&#39;:&#39;1398-1400&#39;}</span>
<span class="sd">    &gt;&gt;&gt; df = create_table_with_schema(schema)</span>

<span class="sd">    &gt;&gt;&gt; table_name = &#39;User_Defined_Table&#39;</span>
<span class="sd">    &gt;&gt;&gt; df = create_table_with_schema(table_name)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">reload_file</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">_extract_parameters</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">data_engine</span><span class="o">.</span><span class="n">LoadTableSettings</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data_engine</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">years</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;years&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
        <span class="n">years</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;years&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;table_list&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">:</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="s2">&quot;_Input_Table&quot;</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span>
    <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="s2">&quot;table_list&quot;</span> <span class="ow">in</span> <span class="n">table_schema</span> <span class="k">for</span> <span class="n">table_schema</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span>
    <span class="k">return</span> <span class="n">data_engine</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.load_table" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">years</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">on_missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">redownload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_downloaded</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">recreate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_created</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Load a table for the given table name and year(s).</p>
<p>This function loads original and standard tables.
Original tables are survey tables and available in three types:
original, cleaned and processed.</p>
<ul>
<li>The 'raw' dataset contains the raw data, identical to the
survey data, without any modifications.</li>
<li>The 'cleaned' dataset contains the raw data with added column
labels, data types, and removal of irrelevant values, but no
changes to actual data values.</li>
<li>The 'processed' dataset applies operations like adding columns,
calculating durations, and standardizing tables across years.</li>
</ul>
<p>Standard tables are defined in this package to facilitate
working with the data and are only available in processed form.</p>
<p>For more information about available tables check the
<a href="https://github.com/Iran-Open-Data/HBSIR/wiki/Tables">tables wiki page</a>.</p>
<h4 id="hbsir.api.load_table--parameters">Parameters</h4>
<p>table_name : str
    Name of the table to load.
years : _Years, default "last"
    Year or list of years to load data for.
dataset : str, default "processed"
    Which dataset to load from - 'processed', 'cleaned', or 'original'.
on_missing : str, default "download"
    Action if data is missing - 'error', 'download', or 'create'
recreate : bool, default False
    Whether to recreate the data instead of loading it
redownload : bool, default False
    Whether to re-download the data instead of loading it
save_downloaded : bool, default True
    Whether to save downloaded data
save_created : bool, default True
    Whether to save newly created data</p>
<h4 id="hbsir.api.load_table--returns">Returns</h4>
<p>DataFrame
    Loaded data for the specified table and years.</p>
<h4 id="hbsir.api.load_table--examples">Examples</h4>
<blockquote>
<blockquote>
<blockquote>
<p>import hbsir
df = hbsir.load_table('food')</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="hbsir.api.load_table--loads-processed-food-table-from-original-survey-tables-for">Loads processed 'food' table from original survey tables for</h3>
<pre><code>latest available year
</code></pre>
<blockquote>
<blockquote>
<blockquote>
<p>df = hbsir.load_table('Expenditures', '1399-1401')</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="hbsir.api.load_table--loads-standard-expenditures-table-for-years-1399-1401">Loads standard 'Expenditures' table for years 1399 - 1401</h3>
<h4 id="hbsir.api.load_table--raises">Raises</h4>
<p>FileNotFoundError
    If data is missing and on_missing='error'.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_table</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="n">_Table</span><span class="p">,</span>
    <span class="n">years</span><span class="p">:</span> <span class="n">_Years</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="n">form</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;processed&quot;</span><span class="p">,</span> <span class="s2">&quot;cleaned&quot;</span><span class="p">,</span> <span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">on_missing</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="s2">&quot;create&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">redownload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_downloaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">recreate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_created</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a table for the given table name and year(s).</span>

<span class="sd">    This function loads original and standard tables.</span>
<span class="sd">    Original tables are survey tables and available in three types:</span>
<span class="sd">    original, cleaned and processed.</span>

<span class="sd">    - The &#39;raw&#39; dataset contains the raw data, identical to the</span>
<span class="sd">    survey data, without any modifications.</span>
<span class="sd">    - The &#39;cleaned&#39; dataset contains the raw data with added column</span>
<span class="sd">    labels, data types, and removal of irrelevant values, but no</span>
<span class="sd">    changes to actual data values.</span>
<span class="sd">    - The &#39;processed&#39; dataset applies operations like adding columns,</span>
<span class="sd">    calculating durations, and standardizing tables across years.</span>

<span class="sd">    Standard tables are defined in this package to facilitate</span>
<span class="sd">    working with the data and are only available in processed form.</span>

<span class="sd">    For more information about available tables check the</span>
<span class="sd">    [tables wiki page](https://github.com/Iran-Open-Data/HBSIR/wiki/Tables).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table_name : str</span>
<span class="sd">        Name of the table to load.</span>
<span class="sd">    years : _Years, default &quot;last&quot;</span>
<span class="sd">        Year or list of years to load data for.</span>
<span class="sd">    dataset : str, default &quot;processed&quot;</span>
<span class="sd">        Which dataset to load from - &#39;processed&#39;, &#39;cleaned&#39;, or &#39;original&#39;.</span>
<span class="sd">    on_missing : str, default &quot;download&quot;</span>
<span class="sd">        Action if data is missing - &#39;error&#39;, &#39;download&#39;, or &#39;create&#39;</span>
<span class="sd">    recreate : bool, default False</span>
<span class="sd">        Whether to recreate the data instead of loading it</span>
<span class="sd">    redownload : bool, default False</span>
<span class="sd">        Whether to re-download the data instead of loading it</span>
<span class="sd">    save_downloaded : bool, default True</span>
<span class="sd">        Whether to save downloaded data</span>
<span class="sd">    save_created : bool, default True</span>
<span class="sd">        Whether to save newly created data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        Loaded data for the specified table and years.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import hbsir</span>
<span class="sd">    &gt;&gt;&gt; df = hbsir.load_table(&#39;food&#39;)</span>
<span class="sd">    # Loads processed &#39;food&#39; table from original survey tables for</span>
<span class="sd">        latest available year</span>
<span class="sd">    &gt;&gt;&gt; df = hbsir.load_table(&#39;Expenditures&#39;, &#39;1399-1401&#39;)</span>
<span class="sd">    # Loads standard &#39;Expenditures&#39; table for years 1399 - 1401</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    FileNotFoundError</span>
<span class="sd">        If data is missing and on_missing=&#39;error&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata</span><span class="o">.</span><span class="n">reload_file</span><span class="p">(</span><span class="s2">&quot;schema&quot;</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">_extract_parameters</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">data_engine</span><span class="o">.</span><span class="n">LoadTableSettings</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">form</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_tables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">years</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_years</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
        <span class="n">table_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
            <span class="n">table_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_cleaner</span><span class="o">.</span><span class="n">load_raw_data</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">year</span><span class="p">))</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">table_parts</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">settings</span><span class="o">.</span><span class="n">form</span> <span class="o">==</span> <span class="s2">&quot;cleaned&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_tables</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">years</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_years</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
        <span class="n">table_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
            <span class="n">table_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">data_engine</span><span class="o">.</span><span class="n">TableHandler</span><span class="p">([</span><span class="n">table_name</span><span class="p">],</span> <span class="n">year</span><span class="p">,</span> <span class="n">settings</span><span class="p">)[</span><span class="n">table_name</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">table_parts</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">data_engine</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span>
            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
            <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.select" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">select</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">urban_rural</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">province</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">county</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Select subset of table based on criteria.</p>
<p>Filters table by urban/rural, province, or county.</p>
<p>Decodes IDs to attributes if needed and removes them after.</p>
<h4 id="hbsir.api.select--parameters">Parameters</h4>
<p>table : pd.DataFrame
    Input DataFrame to filter.</p>

<details class="urban_rural-" open>
  <summary>Literal["Urban", "Rural"], optional</summary>
  <p>Keep only urban or rural households.</p>
</details>
<details class="province-" open>
  <summary>Province, optional</summary>
  <p>Keep only given province(s).</p>
</details>
<details class="county-" open>
  <summary>str or list, optional</summary>
  <p>Keep only given county/counties.</p>
</details>      <h4 id="hbsir.api.select--returns">Returns</h4>
<p>pd.DataFrame
    Subset of input table meeting criteria.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">urban_rural</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;Urban&quot;</span><span class="p">,</span> <span class="s2">&quot;Rural&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">province</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_Province</span><span class="p">]</span> <span class="o">|</span> <span class="n">_Province</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">county</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select subset of table based on criteria.</span>

<span class="sd">    Filters table by urban/rural, province, or county.</span>

<span class="sd">    Decodes IDs to attributes if needed and removes them after.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    table : pd.DataFrame</span>
<span class="sd">        Input DataFrame to filter.</span>

<span class="sd">    urban_rural : Literal[&quot;Urban&quot;, &quot;Rural&quot;], optional</span>
<span class="sd">        Keep only urban or rural households.</span>

<span class="sd">    province : Province, optional</span>
<span class="sd">        Keep only given province(s).</span>

<span class="sd">    county : str or list, optional</span>
<span class="sd">        Keep only given county/counties.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Subset of input table meeting criteria.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">urban_rural</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">table</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">add_attribute</span><span class="p">,</span> <span class="s2">&quot;Urban_Rural&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Urban_Rural == &#39;</span><span class="si">{</span><span class="n">urban_rural</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Urban_Rural&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">county</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">county</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">county</span> <span class="o">=</span> <span class="p">[</span><span class="n">county</span><span class="p">]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">table</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">add_attribute</span><span class="p">,</span> <span class="s2">&quot;County&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;County in </span><span class="si">{</span><span class="n">county</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;County&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">province</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">province</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">province</span> <span class="o">=</span> <span class="p">[</span><span class="n">province</span><span class="p">]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">table</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">add_attribute</span><span class="p">,</span> <span class="s2">&quot;Province&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Province in [</span><span class="si">{</span><span class="n">province</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Province&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.setup" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">setup</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">table_names</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Download, extract, and process HBSIR data.</p>
<p>Handles downloading and extracting the HBSIR data files,
saving them locally, and processing tables.</p>
<p>This sets up the raw data for further analysis. It:</p>
<ul>
<li>Downloads and extracts archive files using archive_handler.</li>
<li>Cleans tables and saves as Parquet using data_cleaner.</li>
</ul>
<h4 id="hbsir.api.setup--parameters">Parameters</h4>
<p>years : str/list/int, default "last"
    Year(s) to download and process.
method : str, default "create"
    "create" to process raw tables or
    "download" to download processed tables.
table_names : str/list, default "all"
    Tables to process. "all" for all tables.
replace : bool, default False
    Whether to overwrite existing files.</p>
<h4 id="hbsir.api.setup--examples">Examples</h4>
<p>setup(1399)
    Process data for 1399.</p>
<p>setup([1390,1400], table_names=['food'])
    Process food table for 1390 and 1400.</p>
<p>setup('1380-1390', method='download')
    Download processed tables for 1380-1390.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span>
    <span class="n">years</span><span class="p">:</span> <span class="n">_Years</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="s2">&quot;download&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
    <span class="n">table_names</span><span class="p">:</span> <span class="n">_OriginalTable</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_OriginalTable</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download, extract, and process HBSIR data.</span>

<span class="sd">    Handles downloading and extracting the HBSIR data files,</span>
<span class="sd">    saving them locally, and processing tables.</span>

<span class="sd">    This sets up the raw data for further analysis. It:</span>

<span class="sd">    - Downloads and extracts archive files using archive_handler.</span>
<span class="sd">    - Cleans tables and saves as Parquet using data_cleaner.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    years : str/list/int, default &quot;last&quot;</span>
<span class="sd">        Year(s) to download and process.</span>
<span class="sd">    method : str, default &quot;create&quot;</span>
<span class="sd">        &quot;create&quot; to process raw tables or</span>
<span class="sd">        &quot;download&quot; to download processed tables.</span>
<span class="sd">    table_names : str/list, default &quot;all&quot;</span>
<span class="sd">        Tables to process. &quot;all&quot; for all tables.</span>
<span class="sd">    replace : bool, default False</span>
<span class="sd">        Whether to overwrite existing files.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    setup(1399)</span>
<span class="sd">        Process data for 1399.</span>

<span class="sd">    setup([1390,1400], table_names=[&#39;food&#39;])</span>
<span class="sd">        Process food table for 1390 and 1400.</span>

<span class="sd">    setup(&#39;1380-1390&#39;, method=&#39;download&#39;)</span>
<span class="sd">        Download processed tables for 1380-1390.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;create&quot;</span><span class="p">:</span>
        <span class="n">archive_handler</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">replace</span><span class="p">)</span>
        <span class="n">data_cleaner</span><span class="o">.</span><span class="n">save_cleaned_tables</span><span class="p">(</span><span class="n">table_names</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">download_processed_data</span><span class="p">(</span><span class="n">table_names</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.setup_config" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">setup_config</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Copy default config file to data directory.</p>
<p>Copies the default config file 'settings-sample.yaml' from
the package directory to 'settings.yaml' in the root data
directory.</p>
<p>Overwrites any existing file if replace=True.</p>
<h4 id="hbsir.api.setup_config--parameters">Parameters</h4>
<p>replace : bool, default False
    Whether to overwrite existing config file.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_config</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy default config file to data directory.</span>

<span class="sd">    Copies the default config file &#39;settings-sample.yaml&#39; from</span>
<span class="sd">    the package directory to &#39;settings.yaml&#39; in the root data</span>
<span class="sd">    directory.</span>

<span class="sd">    Overwrites any existing file if replace=True.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    replace : bool, default False</span>
<span class="sd">        Whether to overwrite existing config file.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">package_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;settings-sample.yaml&quot;</span><span class="p">)</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">root_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;settings.yaml&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dst</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span> <span class="ow">or</span> <span class="n">replace</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="hbsir.api.setup_metadata" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">setup_metadata</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Copy default metadata files to data directory.</p>
<p>Copies metadata files like schema.csv and info.csv from the
package metadata folder to the root data/metadata folder.</p>
<p>Overwrites any existing files if replace=True.</p>
<h4 id="hbsir.api.setup_metadata--parameters">Parameters</h4>
<p>replace : bool, default False
    Whether to overwrite existing metadata files.</p>

          <details class="quote">
            <summary>Source code in <code>hbsir/api.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">setup_metadata</span><span class="p">(</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy default metadata files to data directory.</span>

<span class="sd">    Copies metadata files like schema.csv and info.csv from the</span>
<span class="sd">    package metadata folder to the root data/metadata folder.</span>

<span class="sd">    Overwrites any existing files if replace=True.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    replace : bool, default False</span>
<span class="sd">        Whether to overwrite existing metadata files.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src_folder</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">package_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
    <span class="n">dst_folder</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">root_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dst_folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">dst_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">src_folder</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">dst_folder</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dst</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span> <span class="ow">or</span> <span class="n">replace</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
    
  </body>
</html>